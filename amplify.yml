version: 1
applications:
  - appRoot: frontend
    frontend:
      phases:
        preBuild:
          commands:
            - echo "ðŸ§¹ Cleaning previous install..."
            - rm -rf node_modules package-lock.json
            - echo "ðŸ§© Installing Node.js 20.x..."
            - nvm install 20
            - nvm use 20
            - echo "ðŸ“¦ Installing dependencies..."
            - npm install -g npm@9
            - npm install -g @aws-amplify/cli
            - npm ci || npm install
            # âœ… Fix Rollup native binary bug:
            - echo "ðŸ”§ Rebuilding rollup native binary..."
            - npm rebuild rollup --verbose
        build:
          commands:
            - echo "ðŸš€ Running Vite build..."
            - npm run build
      artifacts:
        baseDirectory: dist
        files:
          - "**/*"
      cache:
        paths:
          - node_modules/**/*
